<!DOCTYPE html>
<html lang="en">
<head>
    <title>Register New Plant</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <style>
        /* Limit width for readability on large screen sizes */
        @media (min-width: 1200px) {
            .container {
                width: 960px;
            }
        }
    </style>
</head>
<body>
    <div class="container d-flex flex-column vh-100">
        <div class="d-flex flex-column text-center mb-5">
            <h2>{{ plant.name }}</h2>
            <h4>{{ plant.species }}</h4>
        </div>

        <div class="d-flex flex-column mx-auto">
            <button class="btn btn-primary mb-3" onClick="waterPlant();">Water</button>
            <button class="btn btn-success mb-3" onClick="fertilizePlant();">Fertilize</button>
        </div>
    </div>

    {{ plant.id|json_script:"uuid" }}

    <script>
        // Parse plant UUID from django context
        const plantUUID = JSON.parse(document.getElementById('uuid').textContent);

        // Takes name of cookie, returns cookie
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    let cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        async function waterPlant() {
            try {
                const response = await fetch(`/water/${plantUUID}`);

                if (!response.ok) {
                    throw new Error('Network response error');
                }

                const responseData = await response.json();
                console.log(responseData);
            } catch (error) {
                console.error('Fetch error:', error);
            }
        }

        async function fertilizePlant() {
            try {
                const response = await fetch(`/fertilize/${plantUUID}`);

                if (!response.ok) {
                    throw new Error('Network response error');
                }

                const responseData = await response.json();
                console.log(responseData);
            } catch (error) {
                console.error('Fetch error:', error);
            }
        }
    </script>
</body>
</html>
